---
- name: main_playbook
  hosts: all 
  gather_facts: true
  become: true
  vars:
    test_version: 1
    installed_soft: ['git','mc','iproute','tcpdump','net-tools','nmap','nftables','bash-completion','bash-completion-extras','most']

  tasks:
  - name: installing soft
    ansible.builtin.yum:
      name:
        - "{{ item }}"
      state: present
    loop: "{{ installed_soft  }}"
  - name: installing soft main
    ansible.builtin.yum:
      name: net-tools
      state: present
  - name: append pager vagrant
    ansible.builtin.lineinfile:
      dest: /home/vagrant/.bashrc
      line: 'export PAGER="most"'
    run_once: true
  - name: append pager root
    ansible.builtin.lineinfile:
      dest: /root/.bashrc
      line: 'export PAGER="most"'
    run_once: true
  - name: Allow related and established connections
    ansible.builtin.iptables:
      chain: INPUT
      match: conntrack
      ctstate: ESTABLISHED,RELATED
      jump: ACCEPT
    become: yes
  - name: open ssh
    ansible.builtin.iptables:
      chain: INPUT
      protocol: tcp
      ctstate: NEW
      match: conntrack
      destination_port: 22
      jump: ACCEPT
      comment: allow ssh
    become: yes
  - name: Set the policy for the INPUT chain to DROP
    ansible.builtin.iptables:
      chain: INPUT
      policy: DROP
  handlers:
    - name: restart_crond
      service:
        name=crond
        state=restarted
    - name: restart_send_mail
      service:
        name=sendmail
        state=restarted
